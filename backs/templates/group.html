	<table id="group_list"></table>
<script type="text/javascript">
    $('#group_list').datagrid({
        url:'/admin/group/list',
        queryParams: {
            data: true,
        },
        border: false,
        pageSize: 20,
        rownumbers: true,
        toolbar: [{
            text: '新增用户组',
            iconCls: 'icon-add',
            handler: function(){
                addFrom('新增用户组', '/admin/group/add')
            }
        }, '-', {
            id: 'btn_group_edit',
            text: '编辑',
            iconCls: 'icon-edit',
            handler: function() {
                var row = $('#group_list').datagrid('getSelected');
                if (row) {
                    addFrom('编辑用户组', '/admin/group/edit/' + row.id);
                }
            }
        }, {
            id: 'btn_group_remove',
            text: '删除',
            iconCls: 'icon-remove',
            handler: function() {
                var ids = [];
                var rows = $('#group_list').datagrid('getSelections');
                if (rows.length < 1) return false;
                for (var i = 0; i < rows.length; i++) {
                    if (rows[i].id == 1) {
                        alert('系统管理员将不被删除');
                        continue;
                    }
                    ids.push(rows[i].id);
                }
                if (!confirm('确定要删除项目吗？')) return false;
                $.ajax({
                    type: 'POST',
                    url: '/admin/group/del',
                    data: {id: ids.join(',')},
                    dataType: 'json',
                    success:function(data){
                        if(data.error == 0){
                            $('#tt').tabs('close', '编辑用户组');
                            $('#group_list').datagrid('reload');
                        }else{
                            alert(str);
                        }
                    }
                });
            }
        }, '-', {
            id: 'btn_group_priv',
            text: '权限',
            iconCls: 'icon-filter',
            handler: function() {
                var row = $('#group_list').datagrid('getSelected');
                if (row) {
                    addFrom('用户组权限', '/admin/group/priv/' + row.id);
                }
            }
        }],
        columns:[[
            {field: 'id', title: 'ID', width: 100},
            {field: 'name', title: '用户组名', width: 120},
            {field: 'role', title: '分组', width: 120},
            {field: 'desc', title: '描述', width: 300},
        ]],
        pagination: true,
        fitColumns: false,
        fit: true,
        onClickRow: function(index, row) {
            checkToolbarButton();
        },
        onDblClickRow: function(index, row) {
            $('#group_list').datagrid('unselectAll');
            $('#group_list').datagrid('checkRow', index);
            checkToolbarButton();
        },
        onLoadSuccess: function(data) {
            $('#btn_group_edit').linkbutton('disable');
            $('#btn_group_remove').linkbutton('disable');
            $('#btn_group_priv').linkbutton('disable');
        }
    });

    function checkToolbarButton(){
        var rows = $('#group_list').datagrid('getSelections');
        if (rows.length == 0 || rows.length > 1) {
            $('#btn_group_edit').linkbutton('disable');
            $('#btn_group_priv').linkbutton('disable');
        } else {
            $('#btn_group_edit').linkbutton('enable');
            $('#btn_group_priv').linkbutton('enable');
        }
        if (rows.length > 0) {
            if (rows.length == 1 && rows[0].id == 1) {
                $('#btn_group_remove').linkbutton('disable');
            } else {
                $('#btn_group_remove').linkbutton('enable');
            }
        } else {
            $('#btn_group_remove').linkbutton('disable');
        }
    }
</script>